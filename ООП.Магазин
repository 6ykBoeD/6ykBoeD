using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;

namespace CSLight
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Seller seller = new Seller();
            Buyer buyer = new Buyer();
            buyer.AddMoney();
            bool isWork = true;

            while (isWork)
            {
                seller.ShowInfo();
                buyer.ShowInfo();
                Console.SetCursorPosition(0, 10);
                Console.WriteLine($"1 - для добавление товара\n2 - Купить товар\n3 - выход\n");
                string inputUser = Console.ReadLine();

                switch (inputUser)
                {
                    case "1":
                        seller.AddProducts();
                        break;

                    case "2":
                        buyer.BuyProduts(seller);
                        break;

                    case "3":
                        isWork = false;
                        break;
                }

                Console.WriteLine("\nНижмите любую клавишу");
                Console.ReadKey();
                Console.Clear();
            }
        }
    }

    class Product
    {
        public string Name { get; private set; }
        public int Price { get; private set; }
        public int Count { get; private set; }

        public Product(string name, int price, int count )
        {
            Name = name;
            Price = price;
            Count = count;
        }

        public void ChangeCount(int count)
        {
            Count = count;
        }
    }

    class Seller
    {
        private List<Product> _products = new List<Product>() { new Product("Хлеб", 25, 1000), new Product("Сок", 50, 100) };

        public int Account { get; private set; }

        public void AddProducts()
        {
            Console.WriteLine("Название продукта :\n");
            string name = Console.ReadLine();

            Console.WriteLine("Введите цену :\n");
            int price = GetNumber();

            Console.WriteLine("Введиет количество :\n");
            int count = GetNumber();

            _products.Add(new Product(name, price, count));
        }

        public void GetProduct(out Product name ,string nameProduct,int count)
        {
            name = null;

            foreach (var product in _products)
            {
                if(nameProduct == product.Name)
                {
                    if (count <= product.Count)
                    {
                        name = product;
                        Account += product.Price * count;
                        int remains = product.Count - count;
                        product.ChangeCount(remains);
                        Console.WriteLine($"Вы преобрели {product.Name} в количестве {count} штук ,общая стоимость {product.Price * count} рублей");
                    }
                    else
                    {
                        Console.WriteLine("Не хватает товара");
                    }
                }
            }
        }

        public void ChangeAccount(Product product,int count)
        {
            Account += product.Price * count;
            int remains = product.Count - count;
            product.ChangeCount(remains);
        }

        public void ShowInfo()
        {
            Console.WriteLine($"Баланс на счете = {Account}");

            foreach (var product in _products)
            {
                Console.WriteLine(product.Name + " = " + product.Price + " в количестве " + product.Count);
            }
        }

        public int GetNumber()
        {
            bool isRepeat = true;

            while (isRepeat)
            {
                bool isSuccess = int.TryParse(Console.ReadLine(), out int count);

                if (isSuccess)
                {
                    return count;
                }
                else
                {
                    Console.WriteLine("Неверное значение");
                }
            }

            return 0;
        }
    }

    class Buyer
    {
        private List<Product> _productsBuyer = new List<Product>();

        public int Account { get; private set; }

        public void AddMoney()
        {
            Account = 10000;
        }

        public void BuyProduts(Seller seller)
        {

            Console.WriteLine("Название продукта :");
            string nameProduct = Console.ReadLine();

            Console.WriteLine("Какое количество требуется :");
            int count = seller.GetNumber();

            seller.GetProduct(out Product name, nameProduct, count);
            

            if(name != null)
            {
                if (Account >= name.Price * count)
                {
                    _productsBuyer.Add(new Product(name.Name, name.Price, count));
                    Account -= name.Price * count;
                }
                else
                {
                    Console.WriteLine("Недостаточно средств");
                }
            }
            else
            {
                Console.WriteLine("Такого товара нет");
            }
        }

        public void ShowInfo()
        {
            int positionX = 0;
            Console.SetCursorPosition(50, positionX);
            Console.WriteLine($"Баланс на счете покупателя = {Account}");

            foreach (var product in _productsBuyer)
            {
                Console.SetCursorPosition(50, ++positionX);
                Console.WriteLine(product.Name + " в количестве " + product.Count);
            }
        }
    }
}

