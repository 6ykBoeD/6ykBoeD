using System;
using System.Collections.Generic;


namespace Fish
{
    internal class Program
    {
        static void Main(string[] args)
        {
            const string CommandNextDay = "1";
            const string CommandAddFish = "2";
            const string CommandRemoveFish = "3";
            const string CommandExit = "4";

            Aquarium aquarium = new Aquarium();
            bool isWork = true;

            while(isWork)
            {
                aquarium.ShowBar();
                Console.WriteLine($"\nВыберите дейтсвие " +
                    $"\n{CommandNextDay} - следующий день" +
                    $"\n{CommandAddFish} - добавить рыбу в аквариум" +
                    $"\n{CommandRemoveFish} - убрать рыбу из аквариума" +
                    $"\n{CommandExit} - закрыть программу");

                switch(Console.ReadLine())
                {
                    case CommandNextDay:
                    aquarium.ToLiveOneDay();
                    break;

                    case CommandAddFish:
                    aquarium.AddFish();
                    break;

                    case CommandRemoveFish:
                    aquarium.RemoveFish();
                    break;

                    case CommandExit:
                    isWork = false;
                    break;
                }

                Console.ReadKey();
                Console.Clear();
            }
        }
    }

    class Fish
    {
        public int CountDays { get;private set; } = 0;
        public string Name { get; private set; }
        public int HP { get; private set; }

        public Fish(string name,int hp)
        {
            Name = name;
            HP = hp;
            CountDays++;
        }

        public void SpendLive()
        {
            int lifeTime = 5;
            HP -= lifeTime;
        }
    }

    class Aquarium
    {
        private Bar _bar = new Bar();
        private Random _random = new Random();
        private Fish[] _blank;
        private List<Fish> _container = new List<Fish>();
        private int _maxNumberFish = 5;

        public Aquarium()
        {
            _blank = new Fish[10];
            _blank[0] = new Fish("Карась", 50);
            _blank[1] = new Fish("Окунь", 75);
            _blank[2] = new Fish("Щука", 80);
            _blank[3] = new Fish("Плотва", 45);
            _blank[4] = new Fish("Язь", 25);
            _blank[5] = new Fish("Акула", 100);
            _blank[6] = new Fish("Скат", 85);
            _blank[7] = new Fish("Сом", 90);
            _blank[8] = new Fish("Минтай", 10);
            _blank[9] = new Fish("Сазан", 15);

            Fill();
        }

        public void ShowBar()
        {
            for (int i = 0; i < _container.Count; i++)
            {
                Console.Write($" {i + 1} - ");
                _bar.Draw(_container[i]);
            }
        }

        public void ToLiveOneDay()
        {
            for (int i = 0; i < _container.Count; i++)
            {
                _container[i].SpendLive();

                if (_container[i].HP <= 0)
                {
                    _container.RemoveAt(i);
                }
            }
        }

        public void AddFish()
        {
            int index;

            if(_container.Count < _maxNumberFish)
            {
                index = _random.Next(_blank.Length);
                _container.Add(_blank[index]);
            }
            else
            {
                Console.WriteLine("В аквариумен нет места");
            }
        }

        public void RemoveFish()
        {
            Console.WriteLine("Введите номер рыбы для удаления");
            int index = GetIndex();
            _container.RemoveAt(index);
        }

        private void Fill()
        {
            int index;

            for (int i = 0; i < _maxNumberFish; i++)
            {
                index = _random.Next(_blank.Length);
                _container.Add(_blank[index]);
            }
        }

        private int GetIndex()
        {
            bool isTrue = true;

            while (isTrue)
            {
                bool isSuccess = int.TryParse(Console.ReadLine(), out int count);

                if (isSuccess)
                {
                    if (count <= _container.Count && count > 0)
                    {
                        return count - 1;
                    }
                    else
                    {
                        Console.WriteLine("Рыбы под таким номером нет");
                    }

                }
                else
                {
                    Console.WriteLine("Неверное значение");
                }
            }

            return 0;
        }
    }

    class Bar
    {
        public void Draw(Fish fish)
        {
            char symbol = ' ';
            int oneIncrements = 5;
            int maxValue = fish.HP / oneIncrements;
            ConsoleColor color = ConsoleColor.White;
            ConsoleColor defaultColor = Console.BackgroundColor;
            string bar = "";
            int hp = (fish.HP - oneIncrements * fish.CountDays) / oneIncrements;

            for (int i = 0; i < hp; i++)
            {
                bar += symbol;
            }

            Console.Write(fish.Name + "\t- ");
            Console.Write('[');
            Console.BackgroundColor = color;
            Console.Write(bar);
            Console.BackgroundColor = defaultColor;
            bar = "";

            for (int i = hp; i < maxValue; i++)
            {
                bar += symbol;
            }

            Console.Write(bar + ']');
            Console.Write($" Количество дней жизни - {fish.CountDays}\n");
        }
    }
}
